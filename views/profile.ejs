<!DOCTYPE html>
<html lang="en">

<body>
   

    <% if (user.UserID === otherUser.UserID) { %>
    <div class="user_profile_section">
        <div class="section_name">
            <h2>My Profile</h2>
        </div>
        <form id="profile-form" action=<%="/profile/" + otherUser.UserID%> method="POST" enctype="multipart/form-data">
            
            <div style="text-align: center; margin-top: 10%;" class="form-group">
                <label for="profilePicture">
                <% if (otherUser.ProfilePicture === null) { %>
                    <img style="width: 50%;height: auto; border-radius: 90%; border-style: solid;" src="/images/default.jpg" alt="missing_profile_picture">
                <% } else { %>
                    <img style="width: 50%;height: 50%; border-radius: 90%; border-style: solid;" src="<%="/" + otherUser.ProfilePicture %>" alt="profile_picture" width="50%" height="50%">
                <% } %></label>
                
                <input style="display: none;" type="file" class="" id="profilePicture" name="profilePicture">
                
                <div style="margin-top: 5%; color: #003c71;font-size: larger; font-weight: bold;">
                    <p id="username-text"><%=otherUser.UserName%></p>
                    
                    <input class="form-control" id="username" name="username" style="display: none; max-width: 60%; text-align: center; margin-left: 20%;" value="<%=otherUser.UserName%>">
                </div>
                <div class="form-group">
                    <div style="margin-top: 5%; color: #003c71;font-size: larger; font-weight: bold;">
                        <p id="nickname-text"><%=otherUser.UserNickName%></p>
                        
                        <input class="form-control" id="nickname" name="nickname" style="display: none; max-width: 60%; text-align: center; margin-left: 20%;" value="<%=otherUser.UserNickName%>">
                    </div>
                    <div style="margin-top: 5%; color: #003c71;font-size: larger; font-weight: bold;">
                        <p id="program-text">Program: <%= otherUser.Program ? otherUser.Program : 'Empty' %></p>
                        
                        <input class="form-control" id="program" name="program" style="display: none; max-width: 60%; text-align: center; margin-left: 20%;" value="<%=otherUser.Program || 'Set program'%>">
                    </div>
                    <div style="margin-top: 5%; color: #003c71;font-size: larger; font-weight: bold;">
                        <p id="studentSet-text">Set: <%= otherUser.StudentSet ? otherUser.StudentSet : 'Empty' %></p>
                    </div>
                </div>
                <%
                // Get the DateJoined value from otherUser
                const dateJoined = new Date(otherUser.DateJoined);

                // Extract year, month, and day
                const year = dateJoined.getFullYear();
                const month = String(dateJoined.getMonth() + 1).padStart(2, '0');
                const day = String(dateJoined.getDate()).padStart(2, '0');

                // Formatted date in YYYY-MM-DD format
                const formattedDate = `${year}-${month}-${day}`;
                %>
                <div style="margin-top: 5%; color: #003c71;font-size: larger; font-weight: bold;">
                    <p id="dateJoined-text"><%= formattedDate %></p>
                </div>
                    <div style="margin-top: 5%; color: #003c71;font-size: larger; font-weight: bold;">
                        <p id="email-text"><%=otherUser.Email%></p>
                        
                        <input class="form-control" id="email" name="email" style="display: none; max-width: 60%; text-align: center; margin-left: 20%;" value="<%=otherUser.Email%>">
                    </div>
                   
                </div>

            </div>
        
            
        </form>
        <p id="error-message" style="color: red; display: none;"></p> <!-- Error message will be inserted here -->
        
    </div>
    <div style="margin-left: 32%;">
        <h2>Your Posts:</h2>
    <% posts.forEach(function(post) { %>
        <div class="post">
            <h3><%= post.Title %>, <%=post.TimePosted%></h3>
            <% if (post.Picture) { %>
                <img src="<%="/" + post.Picture %>" alt="post_picture" width="200" height="200">
            <% } %>
        </div>
    <% }); %>
    </div>
    

    <% } else { %>
    <div class="user_profile_section">
        <div class="section_name">
            <h2><%=otherUser.UserName%></h2>
        </div>
        <div style="text-align: center; margin-top: 10%;" class="form-group">
        <% if (otherUser.ProfilePicture === null) { %>
            <img style="width: 50%;height: auto; border-radius: 90%; border-style: solid;" src="/images/default.jpg" alt="missing_profile_picture">
        <% } else { %>
            <img src="<%="/" + otherUser.ProfilePicture %>" alt="profile_picture" width="50%" height="50%">
        <% } %>
        </div>
        <div>
            <a href="/chat/check/<%= otherUser.UserID %>">Send a message</a>
        </div>
    </div>
    <% } %>


    <script>
        // Initialize a boolean variable to track form changes
        var formChanged = false;
    
        // Event listener for clicks on input fields
        document.querySelectorAll('input').forEach(function(input) {
            input.addEventListener('click', function() {
                formChanged = true; // Set formChanged to true when clicking on an input field
            });
        });
    
        // Event listener for clicks on select elements
        document.querySelectorAll('select').forEach(function(select) {
            select.addEventListener('click', function() {
                formChanged = true; // Set formChanged to true when clicking on a select element
            });
        });
        
    
        // Event listener for clicks on <p> tags within the form
        document.querySelectorAll('p:not(#email-text):not(#dateJoined-text)').forEach(function(p) {
            p.addEventListener('click', function() {
                formChanged = true;
                this.style.display = 'none';
                var form = this.nextElementSibling;
                form.style.display = 'block';
                form.nextElementSibling.style.display = 'block';
                 // Set formChanged to true when interacting with the input
            });
        });
    
        // Event listener for input changes
        document.querySelectorAll('input, select, textarea').forEach(function(element) {
            element.addEventListener('change', function() {
                formChanged = true;
            });
        });
    
        // Event listener for focus out
        document.querySelectorAll('input, textarea').forEach(function(input) {
            input.addEventListener('blur', function() {
                if (formChanged) {
                    document.getElementById('profile-form').submit();
                }
            });
        });
    
        // Event listener for Enter key
        document.body.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && formChanged) {
                e.preventDefault();
                document.getElementById('profile-form').submit();
            }
        });
    
  // Event listener for form submission
document.getElementById('profile-form').addEventListener('submit', function(e) {
    // Prevent the default form submission behavior
    e.preventDefault();

    // Get the value of the "Set" field
    var studentSet = document.getElementById('studentSet').value = "<%=otherUser.StudentSet%>"

    // Check if the "Set" field is not empty
    if (studentSet !== '') {
        // Submit the form
        this.submit();
    }
});
    
        // Event listener for clicks outside the form
        document.body.addEventListener('click', function(event) {
            var profileForm = document.getElementById('profile-form');
            if (!profileForm.contains(event.target)) {
                if (formChanged) {
                    profileForm.submit();
                }
            }
        });
    
        // Event listener for clicks on the student set text
        document.querySelector('#studentSet-text').addEventListener('click', function() {
            if (!document.querySelector('#studentSet')) {
                this.style.display = 'none';
                var select = document.createElement('select');
                select.id = 'studentSet';
                select.name ='studentSet';
                var alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                for (var i = 0; i < alphabet.length; i++) {
                    var option = document.createElement('option');
                    option.text = alphabet[i];
                    select.add(option);
                }
                select.style.margin = '0 auto'; // Centering the select element
                this.parentNode.insertBefore(select, this.nextElementSibling);
                select.style.display = 'block';
                select.nextElementSibling.style.display = 'block';
                formChanged = true; // Set formChanged to true when interacting with the input
    
                // Add event listener to the select element
                select.addEventListener('change', function() {
                    document.getElementById('profile-form').submit();
                });
            }
        });
    </script>
    
</body>
</html>
  
